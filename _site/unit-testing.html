<!DOCTYPE html>
<html>
  <head>
    <title>Postal - Create emails using ASP.NET MVC views</title>
    <link href="bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" />
    <link href="syntax.css" rel="stylesheet"/>
    <link href="site.css" rel="stylesheet"/>
    <meta name="description" content="Create emails using ASP.NET MVC views" />
  </head>
  <body class="doc">
    <header>
      <div class="container">
        <h1><a href="/">Postal</a></h1>
        <p>Create email using ASP.NET MVC views</p>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <h2>Unit Testing</h2>
          <p>When unit testing code that uses Postal, you may want to verify that an email would be sent, without actual sending it.</p>

<p>Postal provides an interface <code>IEmailService</code> and an implementation, <code>EmailService</code>, which actually sends email.</p>

<p>Assuming you use some kind of IoC container, configure it to inject an <code>IEmailService</code> into your controller.</p>

<p>Then use the service to send email objects (instead of calling <code>Email.Send()</code>).</p>
<div class='highlight'><pre><code class='csharp'><span class='k'>public</span> <span class='k'>class</span> <span class='nc'>ExampleController</span> <span class='p'>:</span> <span class='n'>Controller</span> 
<span class='p'>{</span>
    <span class='k'>public</span> <span class='nf'>ExampleController</span><span class='p'>(</span><span class='n'>IEmailService</span> <span class='n'>emailService</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>this</span><span class='p'>.</span><span class='n'>emailService</span> <span class='p'>=</span> <span class='n'>emailService</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>readonly</span> <span class='n'>IEmailService</span> <span class='n'>emailService</span><span class='p'>;</span>

    <span class='k'>public</span> <span class='n'>ActionResult</span> <span class='nf'>Index</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='kt'>dynamic</span> <span class='n'>email</span> <span class='p'>=</span> <span class='k'>new</span> <span class='n'>Email</span><span class='p'>(</span><span class='s'>&quot;Example&quot;</span><span class='p'>);</span>
        <span class='c1'>// ...</span>
        <span class='n'>emailService</span><span class='p'>.</span><span class='n'>Send</span><span class='p'>(</span><span class='n'>email</span><span class='p'>);</span>
        <span class='k'>return</span> <span class='nf'>View</span><span class='p'>();</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<p>Test this controller by creating a mock of the <code>IEmailService</code> interface.</p>

<p>Here&#8217;s an example using <a href='https://github.com/FakeItEasy/FakeItEasy'>FakeItEasy</a>.</p>
<div class='highlight'><pre><code class='csharp'><span class='na'>[Test]</span>
<span class='k'>public</span> <span class='k'>void</span> <span class='nf'>ItSendsEmail</span><span class='p'>()</span>
<span class='p'>{</span>
    <span class='kt'>var</span> <span class='n'>emailService</span> <span class='p'>=</span> <span class='n'>A</span><span class='p'>.</span><span class='n'>Fake</span><span class='p'>&lt;</span><span class='n'>IEmailService</span><span class='p'>&gt;();</span>
    <span class='kt'>var</span> <span class='n'>controller</span> <span class='p'>=</span> <span class='k'>new</span> <span class='n'>ExampleController</span><span class='p'>(</span><span class='n'>emailService</span><span class='p'>);</span>
    <span class='n'>controller</span><span class='p'>.</span><span class='n'>Index</span><span class='p'>();</span>
    <span class='n'>A</span><span class='p'>.</span><span class='n'>CallTo</span><span class='p'>(()</span> <span class='p'>=&gt;</span> <span class='n'>emailService</span><span class='p'>.</span><span class='n'>Send</span><span class='p'>(</span><span class='n'>A</span><span class='p'>&lt;</span><span class='n'>Email</span><span class='p'>&gt;.</span><span class='n'>_</span><span class='p'>))</span>
     <span class='p'>.</span><span class='n'>MustHaveHappened</span><span class='p'>();</span>
<span class='p'>}</span>
</code></pre></div>
        </div>
        <div class="col-md-4">
          <h3>Documentation</h3>
          <nav class="list-group">
            
            <a href="/smtp-config.html" class="list-group-item ">SMTP Configuration</a>
            
            <a href="/strongly-typed-emails.html" class="list-group-item ">Strongly-typed Emails</a>
            
            <a href="/unit-testing.html" class="list-group-item active">Unit Testing</a>
            
            <a href="/attachments.html" class="list-group-item ">Attachments</a>
            
            <a href="/multi-part.html" class="list-group-item ">HTML & Plain-text Emails</a>
            
            <a href="/embedding-images.html" class="list-group-item ">Embedding Images</a>
            
            <a href="/outside-aspnet.html" class="list-group-item ">Postal Outside of ASP.NET</a>
            
            <a href="/email-headers.html" class="list-group-item ">Email Headers</a>
            
            <a href="/create-mail-message.html" class="list-group-item ">Creating Email Without Sending</a>
            
          </nav>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-19461164-1");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>

